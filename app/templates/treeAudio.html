<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>录音</title>
</head>
<body>
    <script src="../static/js/recorder.js"></script>
    <h3>操作</h3>
    <input type="button" value="开始录音" id="startRecord" />
    <input type="button" value="暂停录音" id="pauseRecord" />
    <input type="button" value="停止录音" id="stopRecord" />
    <input type="button" value="播放录音" id="playRecord" />
    <input type="button" value="发送录音" id="sendRecord" />
    <h3>录音时长：<span id="time">0</span>s</h3>
    <audio id="recordedAudio" controls></audio>
</body>
<script>
    let recorder = new Recorder({
        sampleBits: 16,
        sampleRate: 16000,
        numChannels: 1
    });

    document.getElementById('startRecord').addEventListener('click', () => {
        recorder.start().then(() => {
            console.log('开始录音');
        });
    });

    document.getElementById('pauseRecord').addEventListener('click', () => {
        recorder.pause();
        console.log('暂停录音');
    });

    document.getElementById('playRecord').addEventListener('click', () => {
        recorder.play();
        console.log('播放录音');
    });

    document.getElementById('stopRecord').addEventListener('click', () => {
        recorder.stop();
        console.log('停止录音');
    });

    recorder.onprocess = function(duration) {
        document.getElementById('time').textContent = duration.toFixed(2);
    };
</script>
<script>
    document.getElementById('sendRecord').addEventListener('click', () => {
        let blob = recorder.getWAVBlob(); // 获取录音的 WAV 格式数据
        let formData = new FormData();
        formData.append('audio', blob, 'recording.wav');

        fetch('/sendtreeAudio', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            console.log(data);
            // 处理后端返回的数据
        })
        .catch(error => {
            console.error('Error sending recording:', error);
        });
    });
</script>
</html>
